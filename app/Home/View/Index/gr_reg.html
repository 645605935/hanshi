<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/re/bootstrap/css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/re/bootstrap/css/bootstrap-theme.css" />
<link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">

<script type="text/javascript" src="__PUBLIC__/Home/re/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/re/bootstrap/js/bootstrap.js"></script>
<script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>

<link rel="stylesheet" href="__PUBLIC__/Home/re/css/test.css" />

<style type="text/css">
    .left_label{width:158px!important;}
    .right_label{width:auto!important;border:0px!important;}
    .layui-form-item{margin-bottom: 0px!important;}
</style>
<body>

    
        <div class="title">
          <h3 class="gr_title">个人注册</h3>
          <span class="yizc">已有账号,请<a href="{:U('Home/Index/login')}" class="layui-btn layui-btn-mini layui-btn-normal">登录</a></span>
        </div>
        <div class="line"></div>
        <div class="information">

        <form class="layui-form layui-form-pane col-xs-12" method="post" action="" id="add_form" enctype="multipart/form-data">
            <table class="layui-table">
              <colgroup>
                <col width="300">
                <col>
              </colgroup>
              <tbody>
                <tr>
                  <td colspan="2">
                     <div class="layui-inline">
                       <div class="layui-form-item">
                         <label class="layui-form-label left_label">用户名</label>
                         <div class="layui-input-inline">
                            <input type="text" name="username" lay-verify="username" autocomplete="off" placeholder="" class="layui-input username">
                         </div>
                         <label class="layui-form-label right_label">* 6位以上英文字母或数字组成</label>
                       </div>
                     </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                     <div class="layui-inline">
                         <div class="layui-form-item">
                           <label class="layui-form-label left_label">电子邮箱</label>
                           <div class="layui-input-inline">
                              <input type="text" name="email" lay-verify="email" autocomplete="off" placeholder="" class="layui-input email">
                           </div>
                           <label class="layui-form-label right_label">* 用于密码找回及登录</label>
                         </div>
                     </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                     <div class="layui-inline">
                          <div class="layui-form-item">
                            <label class="layui-form-label left_label">手机号</label>
                            <div class="layui-input-inline">
                               <input type="text" name="phone" lay-verify="phone" autocomplete="off" placeholder="" class="layui-input phone">
                            </div>
                            <label class="layui-form-label right_label">* 用于密码找回及登录</label>
                          </div>
                      </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                     <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label left_label">密码</label>
                          <div class="layui-input-inline">
                             <input type="password" name="password" lay-verify="password" autocomplete="off" placeholder="" class="layui-input password">
                          </div>
                          <label class="layui-form-label right_label">* 英文字母或数字组成</label>
                        </div>
                    </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2">
                     <div class="layui-inline">
                        <div class="layui-form-item">
                          <label class="layui-form-label left_label">确认密码</label>
                          <div class="layui-input-inline">
                             <input type="password" name="repassword" lay-verify="repassword" autocomplete="off" placeholder="" class="layui-input repassword">
                          </div>
                          <label class="layui-form-label right_label">* 请再次确认密码</label>
                        </div>
                    </div>
                  </td>
                </tr>

                <tr>
                  <td colspan="2" align="center">
                     <div class="layui-inline">
                        <div class="layui-form-item">
                          <div class="layui-input-inline" style="width:200px;">
                             <input type="checkbox" lay-filter="agree" lay-skin="primary" title="我已经仔细阅读并接受" class="layui-input" checked="">
                          </div>
                          <label class="layui-form-label right_label serivce_btn">《服务协议》</label>
                        </div>
                    </div>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="2" style="text-align:center;">
                    <input type="hidden" name="gid" lay-verify="required" value="{$gid}" autocomplete="off" placeholder="" class="layui-input gid">
                    <input type="hidden" name="agree" lay-verify="agree" value="on" autocomplete="off" placeholder="" class="layui-input agree">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1_add">立即注册</button>
                  </td>
                </tr>
              </tfoot>
            </table>
        </form>
          

        </div>
    
</body>
</html>

<script type="text/javascript">
    $(function(){
        $('.username').blur(function(){
            var username=$('.username').val();
            if(username){
                _ajax_check_username_exist(username);
            }
        });

        $('.email').blur(function(){
            var email=$('.email').val();
            if(email){
                _ajax_check_email_exist(email);
            }
        });

        $('.phone').blur(function(){
            var phone=$('.phone').val();
            if(phone){
                _ajax_check_phone_exist(phone);
            }
        });

        $('.serivce_btn').click(function(){
            //iframe层
            layer.open({
              type: 2,
              title: 'layer mobile页',
              shadeClose: true,
              shade: 0.8,
              area: ['380px', '90%'],
              content: 'http://www.baidu.com/' //iframe的url
            }); 
        });
    });
</script>
<script>
    function _ajax_check_username_exist(username){
         var _json;
         $.ajax({  
             async:false,
             type:'post',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Home/Index/ajax_check_username_exist')}",
             data: {
                username:username
             },
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     layer.msg('用户名已存在');
                     $('.username').focus();
                 }
             },
             error  : function() {  
                 layer.msg('error');
             }  
         }); 
         return _json;
    }

    function _ajax_check_phone_exist(email){
         var _json;
         $.ajax({  
             async:false,
             type:'post',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Home/Index/ajax_check_email_exist')}",
             data: {
                email:email
             },
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     layer.msg('该邮箱已存在');
                     $('.email').focus();
                 }
             },
             error  : function() {  
                 layer.msg('error');
             }  
         }); 
         return _json;
    }

    function _ajax_check_phone_exist(phone){
         var _json;
         $.ajax({  
             async:false,
             type:'post',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Home/Index/ajax_check_phone_exist')}",
             data: {
                phone:phone
             },
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     layer.msg('该手机号已存在');
                     $('.phone').focus();
                 }
             },
             error  : function() {  
                 layer.msg('error');
             }  
         }); 
         return _json;
    }

    //添加
    function _ajax_reg(_data){
         var _json;
         $.ajax({  
             async:false,
             type:'post',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Home/Index/register')}",
             data: _data,
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     layer.msg(json.msg);
                     window.location.href="{:U('Home/Index/login',array('gr'=>1))}";
                 }else{
                     layer.msg(json.msg);
                 }
             },
             error  : function() {  
                 alert('error');
             }  
         }); 
         return _json;
    }

    layui.use(['form', 'layedit', 'laydate', 'upload', 'jquery'], function(){
      var $ = layui.jquery;
      var form = layui.form()
      ,layer = layui.layer
      ,layedit = layui.layedit
      ,laydate = layui.laydate;

      //自定义验证规则
      form.verify({
        username: function(value){
          if(value.length < 5){
            return '用户名至少6个字符';
          }
        }
        ,password: [/(.+){6,12}$/, '密码必须6到12位']
        ,content: function(value){
          layedit.sync(editIndex);
        }
        ,repassword: function(value) {
          //获取密码
          var password = $(".password").val();
          if(!new RegExp(password).test(value)) {
              return '两次输入的密码不一致';
          }
        }
        ,agree: function(value) {
          console.log(value);
          if(!$('#add_form .agree').val()) {
              return '请先同意服务协议';
          }
        }
      });

      //监听提交
      form.on('submit(demo1_add)', function(data){
        $('#add_form .username').val('');
        var _json=_ajax_reg(data.field);
        return false;
      });

      //监听提交
      form.on('checkbox(agree)', function(data){
        if(data.elem.checked){
            $('#add_form .agree').val('on');
        }else{
            $('#add_form .agree').val('');
        }
        return false;
      });

     
    });
</script>