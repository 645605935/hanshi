<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="renderer" content="webkit">
<title>我的作品列表</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" href="__PUBLIC__/Home/css/reset.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/style.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/back.css">
</head>
<body>
<!-- 引用 -->
<include file="Common/header" />


<div class="container mt20">
<div class="mainbox_wrapper">
    <div class="personal-center">
        <div class="ps-center rel">
            <div class="bg-img-wrapper">
                <img class="bg-img" src="__PUBLIC__/Home/images/mycenter_bg_2.jpg">
                <div class="masker abs"></div>
            </div>
            <div class="inner tc">
                <a class="pic mgtb-20" href="#2">
                    <img src="__PUBLIC__/Home/images/img1.jpg">
                </a>
                <h2 class="txt-lg5">
                    <span>昵称</span>
                </h2>
                <div class="elli mgtb-10">
                     <span class="text" title="">现在就介绍一下自己最明显的特点，让人们记住我。</span>
                </div>
                <div class="mgtb-20">
                    <a class="btn2 mgr-20" href="#2"><i class="icon4 icon4-person"></i> 粉丝 <span>0</span></a>
                    <a class="btn2 mgr-20" href="#2"><i class="icon4 icon4-add"></i> 关注 <span>2</span></a>
                    <a class="btn2 mgr-20" href="#2"><i class="icon4 icon4-heart"></i> 赞过 <span>0</span></a>
                    <a class="btn2" href="#2"><i class="icon4 icon4-sound"></i> 声音 <span>0</span></a>
                </div>
            </div>
            <div>
                <div class="tab-1 hor-1 abs tc">
                    <ul>
                        <li class="item active">
                            <a href="#2">
                                <i class="icon4 icon4-house mgr-5"></i>
                                <span class="inl-b">个人主页</span>
                            </a>
                        </li>
                        <li class="item">
                            <a href="#2">
                                <i class="icon4 icon4-backstage mgr-5"></i>
                                <span class="inl-b">主播工作台</span>
                            </a>
                        </li>
                        <li class="item">
                            <a href="#2">
                                <i class="icon4 icon4-backstage mgr-5"></i>
                                <span class="inl-b">作家工作台</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="back-stage txt-mid2 mgtb-20">
            <div class="aside2">
              <div class="nav-1">
                <div class="menu-title"></div>
                <ul m-name="menu">
                  <li class="item active sub-l">
                    <a class="aside_title" href="#2">
                      <i class="iconfont icon-ic_home"></i>首页
                    </a>
                  </li>
                  <li class="item sub-l">
                    <a class="aside_title">
                      <i class="iconfont icon-ic_radio"></i>作品
                    </a>
                    <ul class="sub-m">
                      <li class="item">
                        <a href="#2">上传作品</a>
                      </li>
                      <li class="item">
                        <a href="#2">我的作品</a>
                      </li>
                    </ul>
                  </li>
                    <li class="item gt-40 sub-l">
                      <a class="aside_title">
                        <i class="iconfont icon-ic_fans"></i>社群
                      </a>
                      <ul class="sub-m">
                        <li class="item">
                          <a href="#2">评论</a>
                        </li>
                        <li class="item">
                          <a href="#2">收到的赞</a>
                        </li>
                      </ul>
                    </li>
                  <li class="item sub-l">
                    <a class="aside_title">
                      <i class="iconfont icon-ic_setting"></i>设置
                    </a>
                    <ul class="sub-m">
                      <li class="item ">
                        <a href="#2">账号设置</a>
                      </li>
                    </ul>
                  </li>
                </ul>
                <div class="menu-bottom"></div>
              </div>
            </div>
            <div class="fl">
                <div class="main2 fl">
                    <div class="header2"><span class="intro j-pageTitle">作家工作台</span></div>
                    <div class="mainRight pb0 fl">
                        <div class="msgBoxTitle">

                            <!-- 引用 -->
                            <include file="_book_top_nav" />
                            
                        </div>
                        <div class="managerWrap cf">
                            <div class="mLeftList fl">
                                <div class="leftListWrap">
                                    <div class="titleBox">
                                        <p>共 2 卷， 0 章</p>
                                    </div>
                                    <div class="sectionManage">
                                        <div class="sectionList">
                                            <ul>
                                                <foreach name="list" item="v" key="k">
                                                    <li class="<if condition='$k eq 0'> act act_first </if>">
                                                        <div class="sectionBox" data-id="{$v.id}">
                                                            <p><em>{$v.title}</em></p>
                                                            <p class="f12"><i>{$v.time}</i>共{$v.num}字</p>
                                                        </div>
                                                    </li>
                                                </foreach>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mRightContent fl">
                                <div class="midWrap editWrap">
                                    <form name="formDraft" method="post" action="#2">
                                        <div class="sectionViewWrap">
                                            <div>
                                            <div class="sectionBtnBox cf">
                                                <div class="titleBtn fr">
                                                    <a class="button white cg-del" href="javascript:">删除</a>
                                                    <a class="button white font_count" href="javascript:">字数统计</a>
                                                    <a class="button white save_btn" href="javascript:">保存</a>
                                                    <a class="button green publish_btn" href="javascript:"><span class="icon "></span>发布</a>
                                                </div>
                                                <em class="c999">发布至：</em>
                                                <div class="select-wrap mid">
                                                    <select id="bjid" class="bjid">
                                                        <foreach name="juan_list" item="v">
                                                            <option value="{$v.id}">{$v.title}</option>
                                                        </foreach>
                                                    </select>
                                                </div>
                                            </div>
                                            </div>
                                            <div class="zwText">
                                                <input type="text" class="title" placeholder="此处输入 章节号与章节名。示例：“第十章 天降奇缘”">
                                                <textarea class="content" placeholder="请输入正文"></textarea>
                                            </div>
                                            <div class="say-area">
                                                <p>
                                                    <textarea class="desc" value="" placeholder="作者的话（此段不计入字数）"></textarea>
                                                </p>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<div class="clear"></div>
<!-- 引用 -->
<include file="Common/footer" />


<!-- <div class="mask"></div> -->
<div class="maskUI maskUI2">
    <div class="popupWrap w380">
        <a class="icon closePopup" href="javascript:" title="关闭"></a>
        <h3>新建分卷</h3>
        <div class="popupBody p30">
            <div class="popupContent select">
                <p>分卷名称</p>
                <p class="mb20"><input class="longInput" type="text" value=""></p>
                <p>分卷介绍</p>
                <textarea></textarea>
            </div>
            <div class="confirmBtn">
                <a class="button full" href="javascript:">确定</a>
            </div>
        </div>
    </div>
</div>
<!-- <div class="maskUI maskUI5">
    <div class="popupWrap w380">
        <a attr="click:close;" class="icon closePopup" href="javascript:" title="关闭"></a>
        <h3>消息提示</h3>
        <div class="popupBody p30">
            <div class="popupContent centerTip">
                <p>删除成功，回收站内可找回</p>
            </div>
            <center class="confirmBtn">
                <a href="javascript:;" class="button">确定</a>
            </center>
        </div>
    </div>
</div> -->

<script src="__PUBLIC__/Home/js/jquery.min.js"></script>
<script src="__PUBLIC__/Home/js/index.js"></script>
<script src="__PUBLIC__/layer/layer.js"></script>
</body>
</html>


<script type="text/javascript">
    $(function(){
        $('#create_juan').click(function(){
            var bid=$('.book_juan .bid').val();
            var title=$('.book_juan .title').val();
            var content=$('.book_juan .content').val();

            if(title&&content){
                _ajax_add_juan(bid, title, content);
            }
        });

        //点击章节
        $('.sectionBox').click(function(){
            var zid=$(this).attr('data-id');
            $('.cg-del').attr('data-id', zid);
            $('.font_count').attr('data-id', zid);
            $('.save_btn').attr('data-id', zid);
            $('.publish_btn').attr('data-id', zid);

            _ajax_render_zhang_info(zid);
        });

        //删除
        $('.cg-del').click(function(){
            var zid=$(this).attr('data-id');

            layer.confirm('删除成功，回收站内可找回', {
                btn: ['确定','取消'] 
            }, function(){
                if(zid){
                    _ajax_cg_del_zhang(zid);
                }
            }, function(){
                //取消
            });
            
        });

        //统计字数
        $('.font_count').click(function(){
            var content=$('.mRightContent .editWrap .content').val();

            if(content){
                _ajax_font_count(content);
            }
        });

        //保存
        $('.save_btn').click(function(){
            var zid=$(this).attr('data-id');
            var title=$('.mRightContent .editWrap .title').val();
            var content=$('.mRightContent .editWrap .content').val();
            var desc=$('.mRightContent .editWrap .desc').val();

            if(zid&&title&&content){
                var json=_ajax_save_zhang_draft(zid, title, content, desc);
                if(json.code==0){
                    layer.msg("操作成功");
                }
            }
        });

        //发布
        $('.publish_btn').click(function(){
            var bjid=$('#bjid option:selected').val();

            var zid=$(this).attr('data-id');
            var title=$('.mRightContent .editWrap .title').val();
            var content=$('.mRightContent .editWrap .content').val();
            var desc=$('.mRightContent .editWrap .desc').val();

            if(zid&&title&&content&&bjid){
                var json=_ajax_publish_zhang_draft(bjid, zid, title, content, desc);
                if(json.code==0){
                    layer.msg("发布成功");
                    setTimeout(function(){
                        window.location.reload();
                    },1000);
                }
            }
        });
        

        $('.act_first .sectionBox').trigger('click');
    });
</script>
<script type="text/javascript">
    //异步渲染章节内容
    function _ajax_render_zhang_info(zid){
         var _json;
         $.ajax({  
             async:false,
             type:'get',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Home/User/ajax_render_zhang_info')}",
             data: {
                'zid':zid
             },
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     var data=json.data;

                     $('.mRightContent .editWrap .title').val(data.title);
                     $('.mRightContent .editWrap .content').val(data.content);
                     $('.mRightContent .editWrap .desc').val(data.desc);
                 }else{
                     layer.msg(json.msg);
                 }
             },
             error  : function() {  
                 alert('error');
             }  
         }); 
         return _json;
    }

    //异步删除
    function _ajax_cg_del_zhang(zid){
        var _json;
        $.ajax({  
            type:'get',  
            url : "{:U('Home/User/ajax_cg_del_zhang')}",
            data:{ 
              zid:zid 
            },
            dataType : 'json',
            success  : function(json) {  
                if(json.code == 0){
                    _json=json;
                    layer.msg(json.msg);
                    window.location.reload();
                }else{
                    layer.msg(json.msg);
                    _json=json;
                }
            },
            error  : function() {  
                layer.msg('error');
            }  
        }); 
        return _json;
    }

    //异步恢复为草稿
    function _ajax_restore_zhang(zid){
        var _json;
        $.ajax({  
            type:'get',  
            url : "{:U('Home/User/ajax_restore_zhang')}",
            data:{ 
              zid:zid 
            },
            dataType : 'json',
            success  : function(json) {  
                if(json.code == 0){
                    _json=json;
                    layer.msg('章节已恢复至草稿箱');
                    window.location.reload();
                }else{
                    layer.msg(json.msg);
                    _json=json;
                }
            },
            error  : function() {  
                layer.msg('error');
            }  
        }); 
        return _json;
    }

    //异步统计字数
    function _ajax_font_count(content){
        $.ajax({  
            type:'post',  
            url : "{:U('Home/User/ajax_font_count')}",
            data:{ 
              content:content 
            },
            dataType : 'json',
            success  : function(json) {  
                if(json.code == 0){
                    layer.msg('总字数:'+json.data);
                }
            },
            error  : function() {  
                layer.msg('error');
            }  
        }); 
    }

    //保存
    function _ajax_save_zhang_draft(zid, title, content, desc){
        var _json;
        $.ajax({  
            async:false,
            type:'post',  
            contentType:"application/x-www-form-urlencoded", 
            url : "{:U('Home/User/ajax_edit_zhang')}",
            data:{ 
              id:zid,
              title:title,
              content:content,
              desc:desc,
              status:0 
            },
            dataType : 'json',
            success  : function(json) {
                _json=json;  
            },
            error  : function() {  
                layer.msg('error');
            }  
        }); 
        return _json;
    }

    //发布
    function _ajax_publish_zhang_draft(bjid, zid, title, content, desc){
        var _json;
        $.ajax({  
            async:false,
            type:'post',  
            contentType:"application/x-www-form-urlencoded", 
            url : "{:U('Home/User/ajax_edit_zhang')}",
            data:{ 
              bjid:bjid,
              id:zid,
              title:title,
              content:content,
              desc:desc,
              status:1 
            },
            dataType : 'json',
            success  : function(json) {
                _json=json;  
            },
            error  : function() {  
                layer.msg('error');
            }  
        }); 
        return _json;
    }
    
</script>