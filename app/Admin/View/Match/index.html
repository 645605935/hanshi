<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="renderer" content="webkit">
<title>报名</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" href="__PUBLIC__/Home/css/reset.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/style.css">
<link rel="stylesheet" href="__PUBLIC__/Admin/layui-v1.0.4/layui/css/layui.css"  media="all">
</head>
<body>
<div class="top-add"><a href="#4"><img src="__PUBLIC__/Home/images/img3.jpg" alt=""></a></div>
<div class="head w1000">
    <div class="header fl">
        <div class="logo fl"><a href="#"><img src="__PUBLIC__/Home/images/logo.jpg" alt=""></a></div>
        <div class="search fl">
            <input type="text" class="fl">
            <a href="javascript:;" class="fl"></a>
        </div>
        <div class="head-icon fl">
            <a href="#4" class="gwc"></a>
            <a href="#4" class="yx"></a>
            <a href="#4" class="sc"></a>
        </div>
        <div class="erweima fr"><img src="__PUBLIC__/Home/images/erweima.jpg" alt=""></div>
    </div>
</div>
<div class="clear"></div>
<div class="nav clearfix">
    <ul>
        <li>
            <a href="fenlei-remen.html" class="li-a">发现</a>
            <ul>
                <li><a href="fenlei-remen.html">热门推荐</a></li>
                <li><a href="zuojiatuijian.html">人气主播</a></li>
                <li><a href="zuojiatuijian.html">人气作家</a></li>
                <li><a href="#2">赚钱途径</a></li>
            </ul>
        </li>
        <li>
            <a href="shucheng-zhuye1.html" class="li-a">书城</a>
            <ul>
                <li><a href="tongchengjieyue.html"><span class="color1">在线借阅</span></a></li>
                <li><a href="shucheng-zhuye1.html">图书购买</a></li>
                <li><a href="shucheng-zhuye1.html">电子书</a></li>
                <li><a href="shucheng-zhuye1.html">有声读物</a></li>
            </ul>
        </li>
        <li>
            <a href="tongchengjieyue.html" class="li-a">分类清单</a>
            <ul>
                <li><a href="tongchengjieyue.html">同城借阅</a></li>
                <li><a href="fenlei-zhiyuanzhe.html"><span class="color1">志愿者活动</span></a></li>
                <li><a href="fenlei-remen.html">热门活动</a></li>
                <li><a href="fenlei-chuantong.html">传统文化</a></li>
                <li><a href="fenlei-yanchu.html">精彩演出</a></li>
                <li><a href="fenlei-remen.html">热卖产品</a></li>
                <li><a href="#2">创客空间</a></li>
                <li><a href="fenlei-kecheng.html">精品课程</a></li>
            </ul>
        </li>
        <li>
            <a href="index.html" class="li-a">瞰世商城</a>
            <ul>
                <li><a href="#2"><span class="color1">在线配音</span></a></li>
                <li><a href="#2">录音设备</a></li>
                <li><a href="#2">出版图书</a></li>
                <li><a href="#2">培训课程</a></li>
            </ul>
        </li>
        <li>
            <a href="saishihuodong.html" class="li-a">赛事活动</a>
            <ul>
                <li><a href="saishihuodong-quanbu.html">全部</a></li>
                <li><a href="saishihuodong-yinpin.html"><span class="color1">音频类</span></a></li>
                <li><a href="saishihuodong-shipin.html">视频类</a></li>
                <li><a href="saishihuodong-tupian.html">图片类</a></li>
                <li><a href="saishihuodong-shufa.html">书法类</a></li>
                <li><a href="saishihuodong-qita.html">其他</a></li>
            </ul>
        </li>
        <li>
            <a href="bisaibaoming.html" class="li-a">参赛报名</a>
            <ul>
                <li><a href="bisaibaoming-quanbu.html"><span class="color1">全部</span></a></li>
                <li><a href="bisaibaoming-yinpin.html">音频类</a></li>
                <li><a href="bisaibaoming-shipin.html">视频类</a></li>
                <li><a href="bisaibaoming-tupian.html">图片类</a></li>
                <li><a href="bisaibaoming-shufa.html">书法类</a></li>
                <li><a href="bisaibaoming-qita.html">其他</a></li>
            </ul>
        </li>
        <li>
            <a href="javascript:;" class="li-a">合作通道</a>
            <ul>
                <li><a href="#2"><span class="color1">志愿者报名</span></a></li>
                <li><a href="#2">平台建议</a></li>
                <li><a href="#2">瞰世联线</a></li>
            </ul>
        </li>
        <li>
            <a href="javascript:;" class="li-a">认证</a>
            <ul>
                <li><a href="#2"><span class="color1">个人身份认证</span></a></li>
                <li><a href="#2">作家认证</a></li>
                <li><a href="#2">主播认证</a></li>
            </ul>
        </li>
    </ul>
    <div class="ul-con mt10">
        <div class="lon w1000">
            <div class="fr"><a href="#2">注册</a><span>|</span><a href="#2">登录</a></div>
        </div>
    </div>
</div>
<div class="container p20">
    <div class="con">
        <div class="bm-con">
            <div class="head-tit mb20"><img src="__PUBLIC__/Home/images/img2.png" alt=""></div>
            <div class="slideBox">
                <div class="hd">
                    <ul>
                        <foreach name="type" item="v">
                            <li <if condition="$v['id'] eq $row['type']">class="on"</if>><a href="fenlei-yanchu.html">{$v.title}</a></li>
                        </foreach>
                    </ul>
                </div>
                <div class="bd">
                    <div class="bm-form">
                        <form class="layui-form layui-form-pane col-xs-12" method="post" action="" id="add_form" enctype="multipart/form-data">
                           <table class="layui-table">
                             <tbody>
                               <tr>
                                 <td>
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">剧目名称</label>
                                       <div class="layui-input-inline">
                                         <input type="text" name="title" lay-verify="required" placeholder="" class="layui-input title">
                                       </div>
                                     </div>
                                   </div>
                                 </td>
                                 <td>
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">选择专辑</label>
                                       <div class="layui-input-inline">
                                         <select name="special" class="special">
                                            <option value="请选择">请选择</option>
                                            <foreach name="special" item="v">
                                               <option value="{$v.id}" alt="{$v.title}">{$v.title}</option>
                                            </foreach>
                                         </select>
                                       </div>
                                       <label class="layui-form-label new_special_btn" style="width:89px!important;">
                                         新建专辑
                                       </label>
                                     </div>
                                   </div>
                                 </td>
                               </tr>

                               <tr>
                                 <td colspan="2">

                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">热播时间</label>
                                       <div class="layui-input-inline">
                                         <input class="layui-input start_time LAY_demorange_s" name="start_time" placeholder="开始日">
                                       </div>
                                       <div class="layui-form-mid">-</div>
                                       <div class="layui-input-inline">
                                         <input class="layui-input end_time LAY_demorange_e" name="end_time" placeholder="截止日">
                                       </div>
                                     </div>
                                   </div> 

                                 </td>
                               </tr>

                               <tr>
                                 <td>
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">上传封面</label>
                                       <div class="layui-input-inline">
                                         <input type="file" id="add_upload_img" name="file" class="layui-upload-file">
                                       </div>
                                     </div>
                                   </div>
                                 </td>
                                 <td>
                                   <div class="layui-inline" style="display:none;">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">图片</label>
                                       <div class="layui-input-inline">
                                         <input type="text" name="img" lay-verify="required" class="layui-input img" readonly>
                                       </div>
                                     </div>
                                   </div>
                                   <img class="show_img" data-src="holder.js/140x140" class="img-thumbnail" alt="140x140" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9InllcyI/PjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgdmlld0JveD0iMCAwIDE0MCAxNDAiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiPjwhLS0KU291cmNlIFVSTDogaG9sZGVyLmpzLzE0MHgxNDAKQ3JlYXRlZCB3aXRoIEhvbGRlci5qcyAyLjYuMC4KTGVhcm4gbW9yZSBhdCBodHRwOi8vaG9sZGVyanMuY29tCihjKSAyMDEyLTIwMTUgSXZhbiBNYWxvcGluc2t5IC0gaHR0cDovL2ltc2t5LmNvCi0tPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PCFbQ0RBVEFbI2hvbGRlcl8xNWQ1MzI3ODU3YiB0ZXh0IHsgZmlsbDojQUFBQUFBO2ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWwsIEhlbHZldGljYSwgT3BlbiBTYW5zLCBzYW5zLXNlcmlmLCBtb25vc3BhY2U7Zm9udC1zaXplOjEwcHQgfSBdXT48L3N0eWxlPjwvZGVmcz48ZyBpZD0iaG9sZGVyXzE1ZDUzMjc4NTdiIj48cmVjdCB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCIgZmlsbD0iI0VFRUVFRSIvPjxnPjx0ZXh0IHg9IjQ1IiB5PSI3NC44Ij4xNDB4MTQwPC90ZXh0PjwvZz48L2c+PC9zdmc+" data-holder-rendered="true" style="width: 140px; height: 140px;">
                                 </td>
                               </tr>

                               <tr>
                                 <td>
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">上传视频</label>
                                       <div class="layui-input-inline">
                                         <input type="file" id="add_upload_video" name="file_video" lay-type="video" class="layui-upload-file">
                                       </div>
                                       <a target="_blank" class="layui-form-label show_video_btn" style="width:61px!important;display: none;">
                                         预览
                                       </a>
                                     </div>
                                   </div>
                                 </td>
                                 <td>
                                   <div class="layui-inline" style="display:none;">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">视频</label>
                                       <div class="layui-input-inline">
                                         <input type="text" name="video" lay-verify="required" class="layui-input video" readonly>
                                       </div>
                                     </div>
                                   </div>
                                 </td>
                               </tr>

                               <tr>
                                 <td class="center" colspan="2">
                                   <div class="layui-form-item layui-form-text">
                                       <label class="layui-form-label" style="width: 100%!important;text-align: left;">介绍</label>
                                       <div class="layui-input-block">
                                           <textarea class="layui-textarea layui-hide content" name="content" lay-verify="content" id="editer_add"></textarea>
                                       </div>
                                   </div>
                                 </td>
                               </tr>
                               
                               <tr>
                                 <td>
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">导演/指导</label>
                                       <div class="layui-input-inline">
                                         <input type="text" name="director" lay-verify="required" placeholder="" class="layui-input director">
                                       </div>
                                     </div>
                                   </div>
                                 </td>
                                 <td>
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">表演团队</label>
                                       <div class="layui-input-inline">
                                         <input type="text" name="team" lay-verify="required" placeholder="" autocomplete="off" class="layui-input team">
                                       </div>
                                     </div>
                                   </div>
                                 </td>
                               </tr>

                               <tr>
                                 <td colspan="2">
                                   <div class="layui-inline">
                                     <div class="layui-form-item">
                                       <label class="layui-form-label">表演类型</label>
                                       <div class="layui-input-inline">
                                         <select name="type_1" lay-verify="required" class="type_1" lay-filter="add_type_1">
                                           <option value="">请选择</option>
                                           <foreach name="type_1" item="v">
                                               <option value="{$v.id}">{$v.title}</option>
                                           </foreach>
                                         </select>
                                       </div>
                                       <div class="layui-input-inline">
                                         <select name="type_2" lay-verify="required" class="type_2" lay-filter="add_type_2">
                                           <option value="">请选择</option>
                                         </select>
                                       </div>
                                       <div class="layui-input-inline">
                                         <select name="type_3" lay-verify="required" class="type_3" lay-filter="add_type_3">
                                           <option value="">请选择</option>
                                         </select>
                                       </div>
                                     </div>
                                   </div>
                                 </td>
                               </tr>
                             </tbody>
                             <tfoot>
                               <tr>
                                 <td colspan="2" style="text-align:right;">
                                   <button class="layui-btn" lay-submit="" lay-filter="demo1_add">确认</button>
                                   <button type="reset" class="layui-btn layui-btn-primary reset">重置</button>
                                 </td>
                               </tr>
                             </tfoot>
                           </table>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="clear"></div>
<div id="bot">
    <div class="bot1">
        <div class="w1000 clear">
            <div class="fl colorMain clear left">
                <span class="icon-yqlj mr5 mt5 fl"></span><b class="fl">友情链接：</b>       
            </div>
            <div class="right">
                <ul>
                    <li><a href="#">足球协会</a></li>
                    <li><a href="#">篮球协会</a></li>
                    <li><a href="#">天津市体育局</a></li>
                    <li><a href="#">国家体育总局</a></li>
                    <li><a href="#">全运组委会</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="bot2">
        <div class="w1000 marok">
            <div class="sinak">
                <span class="jt"></span>
                <img src="__PUBLIC__/Home/images/erweima.jpg" class="ma">
            </div>
            <div class="wxk">
                <span class="jt"></span>
                <img src="__PUBLIC__/Home/images/erweima.jpg" class="ma">
            </div>
            <a href="javascript:;" class="bgsinaRed"><img src="__PUBLIC__/Home/images/xing.png" alt=""></a>
            <a href="javascript:;" class="bgwxGreen"><img src="__PUBLIC__/Home/images/xing.png" alt=""></a>
            <a href="index.html" class="botlogo"><img src="__PUBLIC__/Home/images/logoo.png"></a>
        </div>
    </div>
    <div class="bot3">
        <div class="w1000">
            Tian Jin Bei Li Jian Sports Consulting Co., Ltd. ©2017 All Rights Reserved 津ICP备00000000号
        </div>
    </div>
</div>

<script src="__PUBLIC__/Admin/assets/js/jquery.min.js"></script>
<script src="__PUBLIC__/Admin/layui-v1.0.4/layui/layui.js"></script>

<script type="text/javascript">
    $(function(){
        init_editer('editer_add');
    });
</script>


<script>
    //添加
    function _ajax_add(_data){
         var _json;
         $.ajax({  
             async:false,
             type:'post',  
             contentType:"application/x-www-form-urlencoded",
             url : "{:U('Admin/Video/ajax_add')}",
             data: _data,
             dataType : 'json',
             success  : function(json) {
                 if(json.code==0){
                     layer.msg(json.msg);
                     $("#grid-table").addRowData(1, json.data, "first");
                     $("#add_form .reset").trigger('click');
                     $("div[aria-describedby='dialog-confirm_add'] .ui-dialog-titlebar-close").trigger("click");
                 }else{
                     layer.msg(json.msg);
                 }
             },
             error  : function() {  
                 alert('error');
             }  
         }); 
         return _json;
    }

    function init_editer(edit_type){
        layui.use(['form', 'layedit', 'laydate', 'upload'], function(){
          var form = layui.form()
          ,layer = layui.layer
          ,layedit = layui.layedit
          ,laydate = layui.laydate;


          var arr=edit_type.split('_');
          var form_type=arr[1];

          //上传视频
          layui.upload({
             url: "{:U('Admin/Video/lay_upload_file_video')}" //上传接口
             ,elem: '#'+form_type+'_upload_video' //指定原始元素，默认直接查找class="layui-upload-file"
             ,ext : 'mp4'
             ,method: 'post' //上传接口的http类型
             ,success: function(res){ //上传成功后的回调
               if(res.code==0){
                  $('#'+form_type+'_form .video').val(res.data.src);
                  $('#'+form_type+'_form .show_video_btn').show().attr('href', res.data.src);
               }
             }
          });


          //上传图片
          layui.upload({
             url: "{:U('Admin/Video/lay_upload_file')}" //上传接口
             ,elem: '#'+form_type+'_upload_img' //指定原始元素，默认直接查找class="layui-upload-file"
             ,success: function(res){ //上传成功后的回调
               if(res.code==0){
                  $('#'+form_type+'_form .img').val(res.data.src);
                  $('#'+form_type+'_form .show_img').attr('src', res.data.src);
               }
             }
          });

          
          
          //上传图片接口：注意：layedit.set 一定要放在 build前面，否则配置全局接口将无效
          layedit.set({
              uploadImage: {
                  url: "{:U('Admin/Video/lay_upload_file')}", //接口url
                  type: 'post', //默认post
              }
          });

          //创建一个编辑器
          var editIndex = layedit.build(edit_type);

          //自定义验证规则
          form.verify({
            title: function(value){
              if(value.length < 5){
                return '标题至少得5个字符啊';
              }
            }
            ,pass: [/(.+){6,12}$/, '密码必须6到12位']
            ,content: function(value){
              layedit.sync(editIndex);
            }
          });

          //监听提交
          form.on('submit(demo1_add)', function(data){
            var _json=_ajax_add(data.field);
            return false;
          });

          form.on('select(edit_type_1)', function(data){
              var form="edit_form";
              $('#edit_form .type_2').html('<option value="">请选择</option>');
              $('#edit_form .type_3').html('<option value="">请选择</option>');

              var type_1=data.value;
              _ajax_get_type_2(form, type_1);
              console.log(data);
          });

          form.on('select(edit_type_2)', function(data){
              var form="edit_form";
              $('#edit_form .type_3').html('<option value="">请选择</option>');
              
              var type_2=data.value;
              _ajax_get_type_3(form, type_2);
              console.log(data);
          });
        });
    }
</script>
</body>
</html>
